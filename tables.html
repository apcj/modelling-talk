<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>Country and Language</title>
    <script type="text/javascript" src="d3/d3.js"></script>
    <script type="text/javascript" src="d3/d3.geom.js"></script>
    <script type="text/javascript" src="d3/d3.layout.js"></script>
    <link type="text/css" rel="stylesheet" href="style.css"/>
    <style type="text/css">

.table-outline {
  stroke: black;
  stroke-width: 4px;
}

.field {
  opacity: 0;
}
    </style>
  </head>
  <body>
    <div id="body">
      <div id="chart">
        <svg>
          <defs>
              <marker id="Triangle"
                viewBox="0 0 10 10" refX="8" refY="5" 
                markerUnits="strokeWidth"
                markerWidth="4" markerHeight="7"
                orient="auto">
                <path d="M 0 0 L 10 5 L 0 10 z" />
              </marker>
            </defs>
        </svg>
      </div>
    </div>
    <script type="text/javascript">

var tables = [
  { name: "Country", layout: "left", fields: [
    { name: "country_code" },
    { name: "country_name" },
    { name: "flag_uri" }
  ]},
  { name: "Language", layout: "right", fields: [
    { name: "language_code" },
    { name: "language_name" },
    { name: "word_count" }
  ]}
];

var nodes = {};

var w = 1024,
    h = 768,
    tableSize = { width: 300, height: 400 }
    margins = { x: 50, y: 200 };

var svg = d3.select("svg");

var tableGroup = svg.selectAll("g.table")
    .data(tables)
  .enter().append("svg:g")
    .attr("class", "table")
    .attr("transform", function(d) { return "translate(" + 
      (d.layout === "left" ? margins.x : w - margins.x - tableSize.width) + ", " + margins.y + ")" });

var tableOutline = tableGroup.append("svg:rect")
    .attr("class", "table-outline")
    .attr("rx", 40)
    .attr("ry", 40)
    .attr("width", tableSize.width)
    .attr("height", tableSize.height);

var tableName = tableGroup.append("svg:text")
    .attr("x", tableSize.width / 2)
    .attr("y", tableSize.height / 2)
    .attr("text-anchor", "middle")
    .style("font-size", 30)
    .text(function(d) { return d.name; });

var middleHeight = margins.y + tableSize.height / 2;    
var relationshipArrow = svg.append("svg:path")
    .attr("d", "M" + (margins.x + tableSize.width) + " " + middleHeight +
      "L" + (w - margins.x - tableSize.width) + " " + middleHeight)
    .attr("stroke", "black")
    .attr("stroke-width", "5")
    .attr("marker-end", "url(#Triangle)");

var fixed = function(v) { return function() { return v; }};
var stack = d3.layout.stack().y(fixed(50));
var d2 = function(array) { return array.map(function(element) {return [element]}); };

var fieldGroup = tableGroup.selectAll("g.field")
    .data(function(d) { return stack(d2(d.fields)); })
    .enter().append("svg:g")
    .attr("class", "field")
    .attr("transform", function(d) { return "translate(0, " + d[0].y0 + ")"; });
    
var fieldNames = fieldGroup.append("svg:text")
    .attr("x", 10)
    .attr("y", 50)
    .style("font-size", 30)
    .text(function(d) { return d[0].name; });

var animationSteps = [
  function() {
    tableName.transition().duration(500)
      .attr("y", -30);
    tableOutline.transition().duration(500)
      .attr("rx", 0)
      .attr("ry", 0);
  },
  function() {
    fieldGroup.transition().duration(500)
      .style("opacity", 1);
  }
];

window.animationNext = function() {
  animationSteps.shift()();
  if (animationSteps.length < 1) {
    window.animationNext = null;
  }
}

    </script>
  </body>
</html>
